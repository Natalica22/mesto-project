(()=>{"use strict";function e(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function t(t){document.removeEventListener("keydown",e),t.classList.remove("popup_opened")}function n(t){document.addEventListener("keydown",e),t.classList.add("popup_opened")}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(n){return function(e,n){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&t(n)}(n,e)}))}));var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22/",headers:{authorization:"caf54788-8208-42fc-aa9a-a977658e0cb2","Content-Type":"application/json"}};function o(e){var t=arguments.length>2?arguments[2]:void 0,n={method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",headers:r.headers};return t&&(n.body=JSON.stringify(t)),fetch(r.baseUrl+e,n).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function c(e){console.log(e)}function a(e,t,n,r){n.textContent=e.likes.length,e.likes.some((function(e){return e._id===r}))?t.classList.add("place__like-button_active"):t.classList.remove("place__like-button_active")}function i(e,t,n,r){var i=t.querySelector(".place").cloneNode(!0),u=i.querySelector(".place__image"),l=i.querySelector(".place__like-count"),s=i.querySelector(".place__delete-button"),d=i.querySelector(".place__like-button");return u.src=e.link,u.alt=e.name,i.querySelector(".place__title").textContent=e.name,a(e,d,l,r),d.addEventListener("click",(function(){var t;(d.classList.contains("place__like-button_active")?(t=e._id,o("cards/likes/"+t,"DELETE")):function(e){return o("cards/likes/"+e,"PUT")}(e._id)).then((function(e){return a(e,d,l,r)})).catch(c)})),e.owner._id===r?s.addEventListener("click",(function(){var t;(t=e._id,o("cards/"+t,"DELETE")).then((function(){return i.remove()})).catch(c)})):s.remove(),u.addEventListener("click",(function(){return n(e)})),i}function u(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function l(e,t,n){!function(e){return Array.from(e).some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function s(e,t){e.querySelectorAll(t.inputSelector).forEach((function(n){u(e,n,t)})),e.querySelector(t.submitButtonSelector).classList.remove(t.inactiveButtonClass),e.reset()}var d=document.querySelector(".page"),p=d.querySelector(".content"),f=p.querySelector(".profile__avatar"),v=p.querySelector(".profile__name"),m=p.querySelector(".profile__about"),_=d.querySelector("#avatar-popup"),y=_.querySelector(".form"),S=y.querySelector("input[name=avatarUrl]"),q=y.querySelector(".form__save-button"),h=d.querySelector("#profile-popup"),C=p.querySelector(".profile__edit-button"),b=h.querySelector(".form"),L=b.querySelector("input[name=name]"),E=b.querySelector("input[name=about]"),k=b.querySelector(".form__save-button"),x=d.querySelector("#place-popup"),g=p.querySelector(".profile__add-place-button"),B=x.querySelector(".form"),T=B.querySelector("input[name=name]"),A=B.querySelector("input[name=imageUrl]"),D=B.querySelector(".form__save-button"),P=p.querySelector("#place").content,U=p.querySelector(".places"),j=d.querySelector("#popup-image"),w=j.querySelector(".popup__image"),M=j.querySelector(".popup__image-title"),H={formSelector:".form",inputSelector:".form__text",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_inactive",inputErrorClass:"form__text_type_error",errorClass:"form__text-error_active"};function N(e){v.textContent=e.name,m.textContent=e.about,f.src=e.avatar}function O(e){w.src=e.link,w.alt=e.name,M.textContent=e.name,n(j)}function V(){q.textContent="Сохранить"}function z(){k.textContent="Сохранить"}function G(){D.textContent="Создать"}f.addEventListener("click",(function(){V(),s(y,H),n(_)})),y.addEventListener("submit",(function(e){var n;e.preventDefault(),q.textContent="Сохранение...",(n=S.value,o("users/me/avatar","PATCH",{avatar:n})).then((function(e){N(e),t(_)})).catch((function(e){V(),c(e)}))})),C.addEventListener("click",(function(){z(),s(b,H),L.value=v.textContent,E.value=m.textContent,n(h)})),b.addEventListener("submit",(function(e){var n,r;e.preventDefault(),k.textContent="Сохранение...",(n=L.value,r=E.value,o("users/me","PATCH",{name:n,about:r})).then((function(e){N(e),t(h)})).catch((function(e){z(),c(e)}))})),g.addEventListener("click",(function(){G(),s(B,H),function(e,t){var n=e.querySelector(t.submitButtonSelector);n.classList.add(t.inactiveButtonClass),n.disabled=!0}(B,H),n(x)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){var n=t.querySelectorAll(e.inputSelector),r=t.querySelector(e.submitButtonSelector);!function(e,t,n,r){t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)})(e,o,r),l(t,n,r)}))}))}(t,n,r,e)}))}(H),o("users/me").then((function(e){N(e),o("cards").then((function(t){t.forEach((function(t){return n=i(t,P,O,e._id),void U.append(n);var n}))})).catch(c),B.addEventListener("submit",(function(n){var r,a;n.preventDefault(),D.textContent="Сохранение...",(r=T.value,a=A.value,o("cards","POST",{name:r,link:a})).then((function(n){var r;r=i(n,P,O,e._id),U.prepend(r),t(x)})).catch((function(e){G(),c(e)}))}))})).catch(c)})();