(()=>{"use strict";function e(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function t(t){document.removeEventListener("keydown",e),t.classList.remove("popup_opened")}function n(t){document.addEventListener("keydown",e),t.classList.add("popup_opened")}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(n){return function(e,n){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&t(n)}(n,e)}))}));var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22/",headers:{authorization:"caf54788-8208-42fc-aa9a-a977658e0cb2","Content-Type":"application/json"}};function o(e){var t=arguments.length>2?arguments[2]:void 0,n={method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",headers:r.headers};return t&&(n.body=JSON.stringify(t)),fetch(r.baseUrl+e,n).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function a(e){console.log(e)}function c(e,t,n,r){n.textContent=e.likes.length,e.likes.some((function(e){return e._id===r}))?t.classList.add("place__like-button_active"):t.classList.remove("place__like-button_active")}function i(e,t,n,r){var i=t.querySelector(".place").cloneNode(!0),u=i.querySelector(".place__image"),l=i.querySelector(".place__like-count"),s=i.querySelector(".place__delete-button"),d=i.querySelector(".place__like-button");return u.src=e.link,u.alt=e.name,i.querySelector(".place__title").textContent=e.name,c(e,d,l,r),d.addEventListener("click",(function(){var t;(d.classList.contains("place__like-button_active")?(t=e._id,o("cards/likes/"+t,"DELETE")):function(e){return o("cards/likes/"+e,"PUT")}(e._id)).then((function(e){return c(e,d,l,r)})).catch(a)})),e.owner._id===r?s.addEventListener("click",(function(){var t;(t=e._id,o("cards/"+t,"DELETE")).then((function(){return i.remove()})).catch(a)})):s.remove(),u.addEventListener("click",(function(){return n(e)})),i}function u(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function l(e,t,n){!function(e){return Array.from(e).some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function s(e,t){e.querySelectorAll(t.inputSelector).forEach((function(n){u(e,n,t)})),e.querySelector(t.submitButtonSelector).classList.remove(t.inactiveButtonClass),e.reset()}function d(e,t){var n=e.querySelector(t.submitButtonSelector);n.classList.add(t.inactiveButtonClass),n.disabled=!0}var p=document.querySelector(".page"),f=p.querySelector(".content"),v=f.querySelector(".profile__avatar"),m=f.querySelector(".profile__name"),_=f.querySelector(".profile__about"),y=p.querySelector("#avatar-popup"),S=y.querySelector(".form"),q=S.querySelector("input[name=avatarUrl]"),b=S.querySelector(".form__save-button"),h=p.querySelector("#profile-popup"),L=f.querySelector(".profile__edit-button"),C=h.querySelector(".form"),E=C.querySelector("input[name=name]"),k=C.querySelector("input[name=about]"),x=C.querySelector(".form__save-button"),g=p.querySelector("#place-popup"),B=f.querySelector(".profile__add-place-button"),T=g.querySelector(".form"),A=T.querySelector("input[name=name]"),P=T.querySelector("input[name=imageUrl]"),D=T.querySelector(".form__save-button"),U=f.querySelector("#place").content,j=f.querySelector(".places"),w=p.querySelector("#popup-image"),M=w.querySelector(".popup__image"),H=w.querySelector(".popup__image-title"),N={formSelector:".form",inputSelector:".form__text",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_inactive",inputErrorClass:"form__text_type_error",errorClass:"form__text-error_active"};function O(e){m.textContent=e.name,_.textContent=e.about,v.src=e.avatar}function V(e){M.src=e.link,M.alt=e.name,H.textContent=e.name,n(w)}function z(e,t){e.textContent=t}v.addEventListener("click",(function(){s(S,N),d(S,N),n(y)})),S.addEventListener("submit",(function(e){var n;e.preventDefault(),b.textContent="Сохранение...",(n=q.value,o("users/me/avatar","PATCH",{avatar:n})).then((function(e){O(e),t(y)})).catch(a).finally((function(){return z(b,"Сохранить")}))})),L.addEventListener("click",(function(){s(C,N),E.value=m.textContent,k.value=_.textContent,n(h)})),C.addEventListener("submit",(function(e){var n,r;e.preventDefault(),x.textContent="Сохранение...",(n=E.value,r=k.value,o("users/me","PATCH",{name:n,about:r})).then((function(e){O(e),t(h)})).catch(a).finally((function(){return z(x,"Сохранить")}))})),B.addEventListener("click",(function(){s(T,N),d(T,N),n(g)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){var n=t.querySelectorAll(e.inputSelector),r=t.querySelector(e.submitButtonSelector);!function(e,t,n,r){t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)})(e,o,r),l(t,n,r)}))}))}(t,n,r,e)}))}(N),Promise.all([o("users/me"),o("cards")]).then((function(e){var n=e[0];O(n),e[1].forEach((function(e){return t=i(e,U,V,n._id),void j.append(t);var t})),T.addEventListener("submit",(function(e){var r,c;e.preventDefault(),D.textContent="Сохранение...",(r=A.value,c=P.value,o("cards","POST",{name:r,link:c})).then((function(e){var r;r=i(e,U,V,n._id),j.prepend(r),t(g)})).catch(a).finally((function(){return z(D,"Создать")}))}))})).catch(a)})();